#!/usr/bin/env ruby
$LOAD_PATH.push File.expand_path('../../lib', __FILE__)

require 'getrepos'
require 'commander/import'

program :version, GetRepos::VERSION
program :description, 'Download, extract and filter content from repositories (Git/Tarball)'

never_trace!

command :install do |c|
  c.syntax = 'getrepos install <file.json>'
  c.summary = 'Download and install archives to local dir'
  c.description = 'Download and install archive URLs defined in <file.json>'
  c.example 'Process URLs from repos.json', 'getrepos install repos.json'
  c.action do |args, options|
    if args.length != 1
      command(:help).run(:install)
      exit 1
    end

    filename = args.first
    if ! File.exists?(filename)
      puts "ERR: File '#{filename}' not found"
      exit 1
    end

    GetRepos.install_repos(filename)
  end
end

if ARGV.empty?
  global_option '-h', '--help', 'Display help documentation'
  global_option '-v', '--version', 'Display version information'
  command(:help).run
  exit 1
end
